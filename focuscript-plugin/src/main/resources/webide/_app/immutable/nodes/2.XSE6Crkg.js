import{b as gn,d as ua,a as ge,f as ye}from"../chunks/CKrQCllZ.js";import"../chunks/C0b0m6b8.js";import{o as da}from"../chunks/CzYDb0fp.js";import{x as Be,K as va,v as W,F as ke,z as fe,w as Ze,g as r,as as pa,M as ha,a4 as bn,ai as He,C as ae,L as Cn,an as ma,a1 as kn,ap as q,aL as G,N as Ge,ar as wa,aD as _a,aM as Fn,al as Qe,aN as ga,aO as ba,aH as E,J as yn,aP as ka,aq as Rn,P as Wn,aQ as qe,aR as ya,ak as Sa,a2 as Ea,ag as $n,t as ne,y as Ta,aS as Aa,ao as La,ah as Ma,aT as Dn,e as Ia,ab as Na,aU as Ca,aV as Fa,aW as On,q as Ra,aX as Wa,aY as $a,aZ as Da,aI as Oa,u as Z,r as Pa,p as ja,a_ as Sn,a$ as Ba,k as Ha,m as qa,s as k,ax as w,n as S,o as g,b0 as Ka,a3 as Ua,b1 as za,b2 as be}from"../chunks/CxH-hTbb.js";import{e as N,s as ee}from"../chunks/BtWd2ZFL.js";import{b as En}from"../chunks/CrWKYMbG.js";import{i as Ja}from"../chunks/DxchEITl.js";function Ke(e,n){return n}function Ya(e,n,t){for(var i=[],o=n.length,f,d=n.length,l=0;l<o;l++){let h=n[l];Wn(h,()=>{if(f){if(f.pending.delete(h),f.done.add(h),f.pending.size===0){var A=e.outrogroups;Xe(Qe(f.done)),A.delete(f),A.size===0&&(e.outrogroups=null)}}else d-=1},!1)}if(d===0){var a=i.length===0&&t!==null;if(a){var c=t,m=c.parentNode;Sa(m),m.append(c),e.items.clear()}Xe(n,!a)}else f={pending:new Set(n),done:new Set},(e.outrogroups??=new Set).add(f)}function Xe(e,n=!0){for(var t=0;t<e.length;t++)Ea(e[t],n)}var Tn;function Ue(e,n,t,i,o,f=null){var d=e,l=new Map;{var a=e;d=W?ke(fe(a)):a.appendChild(Be())}W&&Ze();var c=null,m=_a(()=>{var T=t();return Fn(T)?T:T==null?[]:Qe(T)}),h,A=!0;function C(){D.fallback=c,Va(D,h,d,n,i),c!==null&&(h.length===0?(c.f&G)===0?Rn(c):(c.f^=G,ue(c,null,d)):Wn(c,()=>{c=null}))}var p=va(()=>{h=r(m);var T=h.length;let _=!1;if(W){var L=pa(d)===ha;L!==(T===0)&&(d=bn(),ke(d),He(!1),_=!0)}for(var K=new Set,$=q,P=wa(),I=0;I<T;I+=1){W&&ae.nodeType===Cn&&ae.data===ma&&(d=ae,_=!0,He(!1));var B=h[I],R=i(B,I),F=A?null:l.get(R);F?(F.v&&kn(F.v,B),F.i&&kn(F.i,I),P&&$.unskip_effect(F.e)):(F=Za(l,A?d:Tn??=Be(),B,R,I,o,n,t),A||(F.e.f|=G),l.set(R,F)),K.add(R)}if(T===0&&f&&!c&&(A?c=Ge(()=>f(d)):(c=Ge(()=>f(Tn??=Be())),c.f|=G)),W&&T>0&&ke(bn()),!A)if(P){for(const[U,te]of l)K.has(U)||$.skip_effect(te.e);$.oncommit(C),$.ondiscard(()=>{})}else C();_&&He(!0),r(m)}),D={effect:p,items:l,outrogroups:null,fallback:c};A=!1,W&&(d=ae)}function le(e){for(;e!==null&&(e.f&ya)===0;)e=e.next;return e}function Va(e,n,t,i,o){var f=n.length,d=e.items,l=le(e.effect.first),a,c=null,m=[],h=[],A,C,p,D;for(D=0;D<f;D+=1){if(A=n[D],C=o(A,D),p=d.get(C).e,e.outrogroups!==null)for(const R of e.outrogroups)R.pending.delete(p),R.done.delete(p);if((p.f&G)!==0)if(p.f^=G,p===l)ue(p,null,t);else{var T=c?c.next:l;p===e.effect.last&&(e.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),V(e,c,p),V(e,p,T),ue(p,T,t),c=p,m=[],h=[],l=le(c.next);continue}if((p.f&qe)!==0&&Rn(p),p!==l){if(a!==void 0&&a.has(p)){if(m.length<h.length){var _=h[0],L;c=_.prev;var K=m[0],$=m[m.length-1];for(L=0;L<m.length;L+=1)ue(m[L],_,t);for(L=0;L<h.length;L+=1)a.delete(h[L]);V(e,K.prev,$.next),V(e,c,K),V(e,$,_),l=_,c=$,D-=1,m=[],h=[]}else a.delete(p),ue(p,l,t),V(e,p.prev,p.next),V(e,p,c===null?e.effect.first:c.next),V(e,c,p),c=p;continue}for(m=[],h=[];l!==null&&l!==p;)(a??=new Set).add(l),h.push(l),l=le(l.next);if(l===null)continue}(p.f&G)===0&&m.push(p),c=p,l=le(p.next)}if(e.outrogroups!==null){for(const R of e.outrogroups)R.pending.size===0&&(Xe(Qe(R.done)),e.outrogroups?.delete(R));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||a!==void 0){var P=[];if(a!==void 0)for(p of a)(p.f&qe)===0&&P.push(p);for(;l!==null;)(l.f&qe)===0&&l!==e.fallback&&P.push(l),l=le(l.next);var I=P.length;if(I>0){var B=f===0?t:null;Ya(e,P,B)}}}function Za(e,n,t,i,o,f,d,l){var a=(d&ga)!==0?(d&ba)===0?E(t,!1,!1):yn(t):null,c=(d&ka)!==0?yn(o):null;return{v:a,i:c,e:Ge(()=>(f(n,a??t,c??o,l),()=>{e.delete(i)}))}}function ue(e,n,t){if(e.nodes)for(var i=e.nodes.start,o=e.nodes.end,f=n&&(n.f&G)===0?n.nodes.start:t;i!==null;){var d=$n(i);if(f.before(i),i===o)return;i=d}}function V(e,n,t){n===null?e.effect.first=t:n.next=t,t===null?e.effect.last=n:t.prev=n}function Ga(e,n,t=!1,i=!1,o=!1){var f=e,d="";ne(()=>{var l=Ta;if(d===(d=n()??"")){W&&Ze();return}if(l.nodes!==null&&(Aa(l.nodes.start,l.nodes.end),l.nodes=null),d!==""){if(W){ae.data;for(var a=Ze(),c=a;a!==null&&(a.nodeType!==Cn||a.data!=="");)c=a,a=$n(a);if(a===null)throw La(),Ma;gn(ae,c),f=ke(a);return}var m=d+"";t?m=`<svg>${m}</svg>`:i&&(m=`<math>${m}</math>`);var h=ua(m);if((t||i)&&(h=fe(h)),gn(fe(h),h.lastChild),t||i)for(;fe(h);)f.before(fe(h));else f.before(h)}})}const An=[...` 	
\r\f¬†\v\uFEFF`];function Xa(e,n,t){var i=e==null?"":""+e;if(n&&(i=i?i+" "+n:n),t){for(var o in t)if(t[o])i=i?i+" "+o:o;else if(i.length)for(var f=o.length,d=0;(d=i.indexOf(o,d))>=0;){var l=d+f;(d===0||An.includes(i[d-1]))&&(l===i.length||An.includes(i[l]))?i=(d===0?"":i.substring(0,d))+i.substring(l+1):d=l}}return i===""?null:i}function Ln(e,n=!1){var t=n?" !important;":";",i="";for(var o in e){var f=e[o];f!=null&&f!==""&&(i+=" "+o+": "+f+t)}return i}function Qa(e,n){if(n){var t="",i,o;return Array.isArray(n)?(i=n[0],o=n[1]):i=n,i&&(t+=Ln(i)),o&&(t+=Ln(o,!0)),t=t.trim(),t===""?null:t}return String(e)}function ze(e,n,t,i,o,f){var d=e.__className;if(W||d!==t||d===void 0){var l=Xa(t,i,f);(!W||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=t}else if(f&&o!==f)for(var a in f){var c=!!f[a];(o==null||c!==!!o[a])&&e.classList.toggle(a,c)}return f}function Je(e,n={},t,i){for(var o in t){var f=t[o];n[o]!==f&&(t[o]==null?e.style.removeProperty(o):e.style.setProperty(o,f,i))}}function Mn(e,n,t,i){var o=e.__style;if(W||o!==n){var f=Qa(n,i);(!W||f!==e.getAttribute("style"))&&(f==null?e.removeAttribute("style"):e.style.cssText=f),e.__style=n}else i&&(Array.isArray(i)?(Je(e,t?.[0],i[0]),Je(e,t?.[1],i[1],"important")):Je(e,t,i));return i}function Pn(e,n,t=!1){if(e.multiple){if(n==null)return;if(!Fn(n))return Ca();for(var i of e.options)i.selected=n.includes(de(i));return}for(i of e.options){var o=de(i);if(Fa(o,n)){i.selected=!0;return}}(!t||n!==void 0)&&(e.selectedIndex=-1)}function xa(e){var n=new MutationObserver(()=>{Pn(e,e.__value)});n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Na(()=>{n.disconnect()})}function et(e,n,t=n){var i=new WeakSet,o=!0;Dn(e,"change",f=>{var d=f?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(d),de);else{var a=e.querySelector(d)??e.querySelector("option:not([disabled])");l=a&&de(a)}t(l),q!==null&&i.add(q)}),Ia(()=>{var f=n();if(e===document.activeElement){var d=On??q;if(i.has(d))return}if(Pn(e,f,o),o&&f===void 0){var l=e.querySelector(":checked");l!==null&&(f=de(l),t(f))}e.__value=f,o=!1}),xa(e)}function de(e){return"__value"in e?e.__value:e.value}const nt=Symbol("is custom element"),at=Symbol("is html");function tt(e){if(W){var n=!1,t=()=>{if(!n){if(n=!0,e.hasAttribute("value")){var i=e.value;In(e,"value",null),e.value=i}if(e.hasAttribute("checked")){var o=e.checked;In(e,"checked",null),e.checked=o}}};e.__on_r=t,Ra(t),Wa()}}function In(e,n,t,i){var o=it(e);W&&(o[n]=e.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&e.nodeName==="LINK")||o[n]!==(o[n]=t)&&(n==="loading"&&(e[$a]=t),e.removeAttribute(n))}function it(e){return e.__attributes??={[nt]:e.nodeName.includes("-"),[at]:e.namespaceURI===Da}}function Nn(e,n,t=n){var i=new WeakSet;Dn(e,"input",async o=>{var f=o?e.defaultValue:e.value;if(f=Ye(e)?Ve(f):f,t(f),q!==null&&i.add(q),await Oa(),f!==(f=n())){var d=e.selectionStart,l=e.selectionEnd,a=e.value.length;if(e.value=f??"",l!==null){var c=e.value.length;d===l&&l===a&&c>a?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=d,e.selectionEnd=Math.min(l,c))}}}),(W&&e.defaultValue!==e.value||Z(n)==null&&e.value)&&(t(Ye(e)?Ve(e.value):e.value),q!==null&&i.add(q)),Pa(()=>{var o=n();if(e===document.activeElement){var f=On??q;if(i.has(f))return}Ye(e)&&o===Ve(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Ye(e){var n=e.type;return n==="number"||n==="range"}function Ve(e){return e===""?null:+e}function rt(e={}){const n={};for(const[t,i]of Object.entries(e))i!=null&&(n[t]=String(i));return n}function xe(e,n,t={}){const i=rt(t);n&&!("token"in i)&&(i.token=n);const o=new URLSearchParams(i),f=o.toString()?`?${o.toString()}`:"";return`/api${e}${f}`}async function oe(e,n,t={},i=fetch){const o=await i(xe(e,n,t));if(!o.ok)throw new Error(await o.text());return await o.json()}async function st(e,n,t={},i=fetch){const o=await i(xe(e,n,t));if(!o.ok)throw new Error(await o.text());return await o.text()}async function ce(e,n,t={},i="",o=fetch){const f=await o(xe(e,n,t),{method:"POST",body:i});if(!f.ok)throw new Error(await f.text());return await f.json()}function y(e){return(e??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}function lt(e){const n=(e||"").toLowerCase();return n.endsWith(".yml")||n.endsWith(".yaml")?"yaml":n.endsWith(".fs")||n.endsWith(".kt")||n.endsWith(".kts")?"kotlin":"plain"}const ot=new Set(["package","import","class","object","interface","fun","val","var","if","else","when","for","while","do","return","break","continue","try","catch","finally","throw","in","is","as","this","super","typealias","sealed","data","enum","override","public","private","protected","internal","open","abstract","final","companion","inline","noinline","crossinline","reified","suspend","operator","infix","tailrec","vararg","const","lateinit","where","get","set","by","constructor","init","module","onDisable"]),ct=new Set(["Int","Long","Double","Float","Boolean","String","Unit","Any","Nothing","List","Map","Set"]);function ft(e){return y(e)}function ut(e){let n=0,t="";const i=e.length,o=l=>/[A-Za-z_]/.test(l),f=l=>/[A-Za-z0-9_]/.test(l),d=l=>/[0-9]/.test(l);for(;n<i;){const l=e[n];if(l==="/"&&e[n+1]==="/"){let a=n+2;for(;a<i&&e[a]!==`
`;)a++;t+='<span class="tok-com">'+y(e.slice(n,a))+"</span>",n=a;continue}if(l==="/"&&e[n+1]==="*"){let a=n+2;for(;a<i&&!(e[a]==="*"&&e[a+1]==="/");)a++;a=Math.min(i,a+2),t+='<span class="tok-com">'+y(e.slice(n,a))+"</span>",n=a;continue}if(l==='"'&&e[n+1]==='"'&&e[n+2]==='"'){let a=n+3;for(;a<i&&!(e[a]==='"'&&e[a+1]==='"'&&e[a+2]==='"');)a++;a=Math.min(i,a+3),t+='<span class="tok-str">'+y(e.slice(n,a))+"</span>",n=a;continue}if(l==='"'){let a=n+1;for(;a<i;){if(e[a]==="\\"){a+=2;continue}if(e[a]==='"'){a++;break}a++}t+='<span class="tok-str">'+y(e.slice(n,a))+"</span>",n=a;continue}if(l==="'"){let a=n+1;for(;a<i;){if(e[a]==="\\"){a+=2;continue}if(e[a]==="'"){a++;break}a++}t+='<span class="tok-str">'+y(e.slice(n,a))+"</span>",n=a;continue}if(l==="@"){let a=n+1;for(;a<i&&f(e[a]);)a++;t+='<span class="tok-ann">'+y(e.slice(n,a))+"</span>",n=a;continue}if(d(l)){let a=n+1;for(;a<i&&/[0-9_]/.test(e[a]);)a++;if(e[a]==="."&&d(e[a+1]))for(a++;a<i&&/[0-9_]/.test(e[a]);)a++;t+='<span class="tok-num">'+y(e.slice(n,a))+"</span>",n=a;continue}if(o(l)){let a=n+1;for(;a<i&&f(e[a]);)a++;const c=e.slice(n,a);ot.has(c)||c==="true"||c==="false"||c==="null"?t+='<span class="tok-kw">'+y(c)+"</span>":ct.has(c)||/^[A-Z]/.test(c)?t+='<span class="tok-type">'+y(c)+"</span>":t+=y(c),n=a;continue}if("{}()[];,.".includes(l)){t+='<span class="tok-op">'+y(l)+"</span>",n++;continue}t+=y(l),n++}return t}function dt(e){let n=0,t="";const i=e.length,o=l=>/[A-Za-z0-9_.-]/.test(l),f=l=>/[0-9]/.test(l);let d=!0;for(;n<i;){const l=e[n];if(l===`
`){t+=`
`,n++,d=!0;continue}if(l==="#"){let a=n+1;for(;a<i&&e[a]!==`
`;)a++;t+='<span class="tok-com">'+y(e.slice(n,a))+"</span>",n=a,d=!1;continue}if(l==='"'||l==="'"){const a=l;let c=n+1;for(;c<i;){if(e[c]==="\\"){c+=2;continue}if(e[c]===a){c++;break}c++}t+='<span class="tok-str">'+y(e.slice(n,c))+"</span>",n=c,d=!1;continue}if(d){let a=n;for(;a<i&&(e[a]===" "||e[a]==="	");)a++;if(t+=y(e.slice(n,a)),n=a,e[n]==="-"){t+='<span class="tok-op">-</span>',n++;let m=n;for(;m<i&&(e[m]===" "||e[m]==="	");)m++;t+=y(e.slice(n,m)),n=m}let c=n;for(;c<i&&o(e[c]);)c++;if(c>n&&e[c]===":"){t+='<span class="tok-key">'+y(e.slice(n,c))+"</span>",t+='<span class="tok-op">:</span>',n=c+1,d=!1;continue}}if(f(l)){let a=n+1;for(;a<i&&/[0-9_]/.test(e[a]);)a++;if(e[a]==="."&&f(e[a+1]))for(a++;a<i&&/[0-9_]/.test(e[a]);)a++;t+='<span class="tok-num">'+y(e.slice(n,a))+"</span>",n=a,d=!1;continue}if(/[A-Za-z]/.test(l)){let a=n+1;for(;a<i&&/[A-Za-z0-9_-]/.test(e[a]);)a++;const c=e.slice(n,a);c==="true"||c==="false"||c==="null"?t+='<span class="tok-kw">'+y(c)+"</span>":t+=y(c),n=a,d=!1;continue}t+=y(l),n++,d=!1}return t}function vt(e,n){return n==="kotlin"?ut(e):n==="yaml"?dt(e):ft(e)}var pt=ye("<option> </option>"),ht=ye('<div role="button" tabindex="0"><span aria-hidden="true">üìÑ</span> <span> </span></div>'),mt=ye('<div role="button" tabindex="0"> </div>'),wt=ye('<header><strong>Focuscript Web IDE</strong> <span id="status"> </span> <span class="spacer"></span> <label class="muted" for="workspaceSelect">Workspace</label> <select id="workspaceSelect"></select> <button id="newWorkspaceBtn">New Module</button> <button id="refreshBtn">Refresh</button> <button id="apiBtn">API</button> <button id="reloadBtn" class="primary">Reload Module</button> <button id="reloadAllBtn" class="danger">Reload All</button> <button id="saveBtn" class="primary">Save</button></header> <main><aside id="sidebar"><div id="sidebarTop"><div><strong>Files</strong></div> <button id="newFileBtn">New</button></div> <div id="fileList"></div> <div id="tips"><div><strong>Notes</strong></div> <ul><li>The server prints a URL with a token. Keep it private.</li> <li>The token is part of the link. Treat the full URL as a secret.</li> <li>Typical flow: edit ‚Üí <b>Save</b> ‚Üí <b>Reload Module</b>.</li> <li>Compilation happens asynchronously inside Focuscript.</li></ul></div></aside> <section id="editor"><div id="editorTop"><span id="currentFile"> </span> <span id="dirty">‚óè unsaved</span> <span id="job"> </span></div> <div id="editorWrap"><pre id="highlight"><code id="hlCode"><!></code></pre> <textarea id="text" spellcheck="false"></textarea></div></section></main> <div id="modalBackdrop"><div id="modal"><div id="modalHeader"><strong>Focuscript API (from _runtime/focuscript-api.jar)</strong> <span class="spacer"></span> <input id="apiSearch" placeholder="Search class..."/> <button id="modalClose">Close</button></div> <div id="modalBody"><div id="apiList"></div> <div id="apiDetail" class="muted"> </div></div></div></div>',1);function Tt(e,n){ja(n,!1);const t=E(),i=E();let o="",f=E("Connecting..."),d=E(""),l=E([]),a=E(null),c=null,m=E([]),h=E(null),A=E(!1),C=E(""),p=E(""),D=!1,T=E(!1),_=E(null),L=E(null),K=E(!1),$=E(""),P=E(null),I=E(null),B=E(!1);function R(s){w(f,s)}function F(s){w(d,s||"")}function U(s){w(A,!!s)}function te(){!r(_)||!r(L)||(be(L,r(L).scrollTop=r(_).scrollTop),be(L,r(L).scrollLeft=r(_).scrollLeft))}function ie(){const s=lt(r(h)||"");w(p,vt(r(C)||"",s)),te()}function re(s,u,v){w(C,s),U(!0),r(T)||Ee(),requestAnimationFrame(()=>{r(_)&&(be(_,r(_).selectionStart=u),be(_,r(_).selectionEnd=v),r(_).focus(),te())})}function Se(s,u){return s.lastIndexOf(`
`,u-1)+1}function jn(s){if(!r(_))return;const u=r(C),v=r(_).selectionStart,b=r(_).selectionEnd;if(u.slice(v,b).includes(`
`)){const M=Se(u,v),j=u.indexOf(`
`,b),J=j===-1?u.length:j,Y=u.slice(M,J).split(`
`);if(!s){const x=Y.map(fa=>`	${fa}`).join(`
`),_e=u.slice(0,M)+x+u.slice(J);re(_e,v+1,b+Y.length);return}let Pe=0,je=0;const sa=Y.map((x,_e)=>x.startsWith("	")?(Pe+=1,_e===0&&(je=1),x.slice(1)):x.startsWith("  ")?(Pe+=2,_e===0&&(je=2),x.slice(2)):x),la=u.slice(0,M)+sa.join(`
`)+u.slice(J),oa=v-(v>M?je:0),ca=b-Pe;re(la,oa,ca);return}if(s){const M=Se(u,v);let j=0;if(u.startsWith("	",M)?j=1:u.startsWith("  ",M)&&(j=2),j>0){const J=u.slice(0,M)+u.slice(M+j),we=Math.max(v-j,M),Y=Math.max(b-j,M);re(J,we,Y)}return}const H=u.slice(0,v)+"	"+u.slice(b),Q=v+1;re(H,Q,Q)}function Bn(){if(!r(_))return;const s=r(C),u=r(_).selectionStart,v=r(_).selectionEnd,b=Se(s,u),O=s.slice(b,u),H=O.match(/^[\t ]*/),Q=H?H[0]:"",M=O.trimEnd(),j=M.endsWith("{")||M.endsWith("(")||M.endsWith("["),J=`
${Q}${j?"	":""}`,we=s.slice(0,u)+J+s.slice(v),Y=u+J.length;re(we,Y,Y)}function Hn(s){if(!r(T)&&!(s.metaKey||s.ctrlKey||s.altKey)){if(s.key==="Tab"){s.preventDefault(),jn(s.shiftKey);return}s.key==="Enter"&&(s.preventDefault(),Bn())}}function Ee(){D||(D=!0,requestAnimationFrame(()=>{D=!1,ie()}))}async function ve(){if(!o){R("Missing token. Open this page using the URL printed by /fs webide.");return}const s=await oe("/status",o);R(`Running (v${s.pluginVersion}) ‚Ä¢ loadedModules=${s.loadedModules} ‚Ä¢ ${s.bind}:${s.port}`)}async function pe(){const s=await oe("/workspaces",o);w(l,s);const u=new Set(s.map(v=>v.id));(!r(a)||!u.has(r(a)))&&w(a,s[0]?.id??null),c=r(a)}function qn(s){const u=new Set(["script.yml"]);return[...s].sort((v,b)=>{const O=u.has(v)?-1:0,H=u.has(b)?-1:0;if(O!==H)return O-H;const Q=v.startsWith("src/")?-1:0,M=b.startsWith("src/")?-1:0;return Q!==M?Q-M:v.localeCompare(b)})}async function X(){if(!r(a))return;const s=await oe("/files",o,{ws:r(a)});w(m,qn(s))}async function Te(s){if(!r(a)||r(A)&&!confirm("You have unsaved changes. Discard and open another file?"))return;w(h,s),U(!1);const u=await st("/file",o,{ws:r(a),path:s});w(C,u),ie(),await X()}async function Kn(){!r(a)||!r(h)||(await ce("/file",o,{ws:r(a),path:r(h)},r(C)),U(!1),F("Saved."),setTimeout(()=>F(""),1200))}async function Un(){if(!r(a))return;const s=prompt(`New file path (relative to workspace root).
Example: src/new.fs`);s&&(await ce("/newFile",o,{ws:r(a),path:s},""),await X(),await Te(s))}async function zn(){const s=(prompt(`New module id (letters/numbers/._-)
Example: my_module`,"my_module")||"").trim();if(!s)return;const u=(prompt("Module display name",s)||s).trim(),v=(prompt("Module version","1.0.0")||"1.0.0").trim(),O=confirm(`Set load: enable ?

(If NO: it will be created with load: disable, and won't auto-load on restart until you change it.)`)?"enable":"disable",H=await ce("/newWorkspace",o,{id:s,name:u,version:v,load:O},"");F(`Created module: ${H.id}`),await ve(),await pe(),w(a,s),c=s,w(h,null),w(C,""),ie(),U(!1),await X(),await Te("script.yml")}async function en(s){F(`Job ${s}: running...`);let u=null;for(;;){const v=await oe("/job",o,{id:s});if(u=v,F(`Job ${s}: ${v.status} ‚Ä¢ ${v.message}`),v.status==="success"||v.status==="error")break;await new Promise(b=>setTimeout(b,900))}u?.status==="error"&&alert(u.message||"Job failed"),await ve(),await pe(),await X()}async function Jn(){if(!r(a))return;if(r(A)){alert("Please save before reloading.");return}const s=await ce("/reload",o,{ws:r(a)},"");await en(s.jobId)}async function Yn(){if(!confirm("Reload ALL modules? This disables all modules, then queues recompilation."))return;const s=await ce("/reloadAll",o,{},"");await en(s.jobId)}async function Vn(){if(r(a)){if(r(A)&&!confirm("You have unsaved changes. Discard and switch workspace?")){w(a,c);return}c=r(a),w(h,null),w(C,""),ie(),U(!1),await X()}}function Ae(s){w(K,s)}async function Zn(){if(Ae(!0),!r(P)){w(B,!0);try{w(P,await oe("/apiIndex",o))}finally{w(B,!1)}}w(I,null),w($,"")}function Gn(s){w(I,s)}function Xn(s){s.target===s.currentTarget&&Ae(!1)}da(async()=>{o=new URL(window.location.href).searchParams.get("token")||"";try{await ve(),await pe(),await X(),F("")}catch(u){console.error(u),R("Failed to connect. Check token and server logs.")}ie()}),Sn(()=>(r(P),r($)),()=>{w(t,(r(P)??[]).filter(s=>{const u=(r($)||"").trim().toLowerCase();return u?(s.name||"").toLowerCase().includes(u):!0}))}),Sn(()=>(r(B),r(I)),()=>{w(i,(()=>{if(r(B))return"Loading API index...";if(!r(I))return"Select a class to view members.";const s=r(I),u=[];if(u.push(s.name),u.push(""),s.fields&&s.fields.length){u.push("FIELDS");for(const v of s.fields)u.push("  "+v);u.push("")}if(s.methods&&s.methods.length){u.push("METHODS");for(const v of s.methods)u.push("  "+v)}return u.join(`
`)})())}),Ba(),Ja();var nn=wt(),Le=Ha(nn),Me=k(S(Le),2),Qn=S(Me,!0);g(Me);var se=k(Me,6);ne(()=>{r(a),Ka(()=>{r(l)})}),Ue(se,5,()=>r(l),Ke,(s,u)=>{var v=pt(),b=S(v);g(v);var O={};ne(()=>{ee(b,`${r(u),Z(()=>r(u).id)??""}${r(u),Z(()=>r(u).loaded?" (loaded)":"")??""}`),O!==(O=(r(u),Z(()=>r(u).id)))&&(v.value=(v.__value=(r(u),Z(()=>r(u).id)))??"")}),ge(s,v)}),g(se);var an=k(se,2),tn=k(an,2),rn=k(tn,2),sn=k(rn,2),ln=k(sn,2),xn=k(ln,2);g(Le);var Ie=k(Le,2),Ne=S(Ie),Ce=S(Ne),ea=k(S(Ce),2);g(Ce);var on=k(Ce,2);Ue(on,5,()=>r(m),Ke,(s,u)=>{var v=ht(),b=k(S(v),2),O=S(b,!0);g(b),g(v),ne(()=>{ze(v,1,"file"+(r(u)===r(h)?" active":"")),ee(O,r(u))}),N("click",v,()=>Te(r(u))),ge(s,v)}),g(on),Ua(2),g(Ne);var cn=k(Ne,2),Fe=S(cn),Re=S(Fe),na=S(Re,!0);g(Re);var fn=k(Re,2);let un;var dn=k(fn,2),aa=S(dn,!0);g(dn),g(Fe);var We=k(Fe,2);let vn;var he=S(We),pn=S(he),ta=S(pn);Ga(ta,()=>r(p)),g(pn),g(he),En(he,s=>w(L,s),()=>r(L));var z=k(he,2);za(z),En(z,s=>w(_,s),()=>r(_)),g(We),g(cn),g(Ie);var me=k(Ie,2);let hn;var mn=S(me),$e=S(mn),De=k(S($e),4);tt(De);var ia=k(De,2);g($e);var wn=k($e,2),Oe=S(wn);Ue(Oe,5,()=>r(t),Ke,(s,u)=>{var v=mt(),b=S(v);g(v),ne(()=>{ze(v,1,(r(I),r(u),Z(()=>"apiItem"+(r(I)&&r(I).name===r(u).name?" active":"")))),ee(b,`${r(u),Z(()=>r(u).name)??""} (${r(u),Z(()=>r(u).kind)??""})`)}),N("click",v,()=>Gn(r(u))),ge(s,v)}),g(Oe);var _n=k(Oe,2),ra=S(_n,!0);g(_n),g(wn),g(mn),g(me),ne(()=>{ee(Qn,r(f)),ee(na,r(h)?`${r(a)} / ${r(h)}`:"No file selected"),un=Mn(fn,"",un,{display:r(A)?"inline":"none"}),ee(aa,r(d)),vn=ze(We,1,"",null,vn,{composing:r(T)}),hn=Mn(me,"",hn,{display:r(K)?"flex":"none"}),ee(ra,r(i))}),et(se,()=>r(a),s=>w(a,s)),N("change",se,Vn),N("click",an,zn),N("click",tn,async()=>{await ve(),await pe(),await X()}),N("click",rn,Zn),N("click",sn,Jn),N("click",ln,Yn),N("click",xn,Kn),N("click",ea,Un),Nn(z,()=>r(C),s=>w(C,s)),N("keydown",z,Hn),N("compositionstart",z,()=>{w(T,!0)}),N("compositionend",z,()=>{w(T,!1),Ee()}),N("input",z,()=>{U(!0),r(T)||Ee()}),N("scroll",z,te),Nn(De,()=>r($),s=>w($,s)),N("click",ia,()=>Ae(!1)),N("click",me,Xn),ge(e,nn),qa()}export{Tt as component};
